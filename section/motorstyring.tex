\section{Motorstyring }\label{sec:sec_motorstyring}
Målinger af vognens dynamik gennemgået i afsnit \ref{sec:sec_motoroverforelse}, er baseret på stepresponset af vognen ved en konstant spænding, men med faste strømbegrænsninger i intervaller.

Dette giver anledning til at vægle en motorstyring der sørger for en konstant strøm til motoren.
 
Således vil udgangssignalet fra regulatoren i form af en reguleringsspænding, $V_{reg}$ omsættes i motorstyringen til den ønskede strøm $I_{reg}$, der igen giver den ønskede acceleration af vognen.  


\begin{itemize}
	\item Omsætter volt til ampere (current control)
	\item Pnp og npn transistorer med relativ høj strømrate
	\item Motor accelererer baseret på ampere. Volt angiver tophastighed.
	\item Min 1.25A maks 2.25A
\end{itemize}

\subsection{Design og dimensionering af motorregulering}
\husk{Kenneth}{Tekst rettes}
Da DC-motoren er en kompleks enhed, hvis dynamik og opbygning ligger uden for opfanget af denne rapport. 
Anvendes en simpel feedback regulering af strømmen igennem transistorerne, således at forholdet mellem indgangs signalet og udgangsstrømmen til motoren holdes konstant, som kan beskrives ved
\husk{JJ}{teoretisk model for motor styring}

I fig xx ses den valgte typografi af motor regulator.
\husk{JJ}{Diagram af motorstyring}

\husk{JJ}{Beskrivelse af motor regulator design} 
\husk{JJ}{Håndtering af transiente spændinger igennem bypass dioder}

\subsection{Beregninger}
\husk{JJ}{beregninger af forhold mellem spænding og strøm i regulatoren}
\husk{JJ}{PSpice simulering af regulator}

\subsection{Overførelsesfunktion af motor}
For at bestemme dynamikken af DC-motoren opstilles en forenklet model af motoren.

\begin{figure}[h!]
	\centering
	\includegraphics[width=.6\textwidth]{billeder/motor_model.png}
	\caption[sss]{Model af elektromotorisk system til brug ved modellering af motor\protect\footnotemark.}
	\label{fig:motor_model}
\end{figure}
\FloatBlock
\footnotetext{Figuren er tilrettet fra \cite[Figur 2.16, s. 52]{Reg2015}}

Ved at fastholde motoren, således at den mod-elektromotoriskekraft ($e_{mod}$) kan sættes til nul dvs. $\omega = 0$, er det muligt at måle motores induktans.
Modellen kan således omstilles som
\begin{align}
	v(t) = R_ai(t) + L_a\dfrac{di(t)}{dt}
\end{align}
Måling af strømmen igennem motoren er forstaget over en $0,2 \si{\ohm}$ test-modstand
\footnote{Modstand med meget lille induktans}.
Motorens egen modstand er målt til $R_{motor} = 3,2 \si{\ohm}$, hvilket giver en samlet modstand på $R_a = R_{test} + R_{motor} = 3,4 \si{\ohm}$ i test opstillingen. 

\begin{figure}[h!]
	\centering
	\includegraphics[width=.8\textwidth]{billeder/motor_L.png}
	\caption{Måling af transient forløb for strømmen igennem DC-motor.}
	\label{fig:motor_dynamik_scoop}
\end{figure}


Tidskonstanten for ladning af en spole er, $\tau = \frac{L}{R}$.
For at bestemme $L$, måles tiden $t$ ved $5\tau$ som er ved
\begin{align}
	\% opladning = \left( 1 - \frac{1}{e^{t/\tau}} \right) \cdot 100\% \Rightarrow  \left( 1 - \frac{1}{e^{t/5}} \right) \cdot 100 \approx 99,32\% 
\end{align}
derefter kan $L_a$ bestemmes som, ved aflæst tid på $16,9\si{\milli\second}$ i fig. \ref{fig:motor_dynamik_scoop} 
\begin{align}
	5\tau = \frac{L_a}{R_a} \Rightarrow L_a = 16,9\si{\milli\second} \cdot 3,4 \si{\ohm} = 57,5 \si{\milli\henry}
\end{align}

Overførelsesfunktion for motoren opstilles som
\begin{align}
H_{motor} = \frac{V_o}{V_i} = \frac{s L_a}{s L_a + R_{motor}} = \frac{ \frac{L_a}{R_{motor}}s}{ \frac{L_a}{R_{motor}}s +1} = \frac{\num{18E-3}s}{\num{18E-3}s +1}
\end{align}  


